1) Analise o seguinte código:

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>GEPLIC — Gerenciador de Projetos de Licitação</title>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
  <style>
    /* VARIÁVEIS DE COR E ESTILO MODERNIZADAS */
    :root {
      --bg: #f9fafb;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #1f2937;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --blue-main: #3b82f6; 
      --blue-bg: #eff6ff; 
      --blue-border: rgba(59, 130, 246, 0.2); 
      --border: #e5e7eb;
      --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    }
    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      background: var(--bg);
      color: var(--accent);
      line-height: 1.5;
    }
    .wrap {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }
    header {
      display: flex;
      flex-direction: column; 
      margin-bottom: 24px;
      gap: 16px;
    }
    .header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 16px;
    }
    h1 {
      font-size: 24px;
      margin: 0;
      font-weight: 700;
    }
    
    /* ESTILO PARA INFO DO PROCESSO */
    .proc-info {
        background: var(--card);
        border-radius: 8px;
        padding: 12px 16px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        border: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 15px;
        margin-bottom: 16px;
    }
    .proc-details {
        flex-grow: 1;
        font-size: 15px;
        /* Adicionado width para ajudar no justify */
        width: 100%; 
    }
    .proc-details span {
        font-weight: 600;
        color: var(--blue-main);
    }
    .proc-details > div {
        margin-bottom: 4px;
        /* Adicionado width para ajudar no justify */
        width: 100%; 
    }
    /* NOVO ESTILO PARA FORÇAR JUSTIFICAÇÃO NO OBJETO */
    #displayProcObject span {
        /* Garante que o span se comporte como um bloco para o justify */
        width: 100%;
        text-align: justify;
        text-justify: inter-word;       
    }
    /* FIM NOVO ESTILO */
    
    /* ESTILO DO DASHBOARD/CRONOGRAMA */
    .project-timeline {
        background: var(--card);
        border-radius: 8px;
        padding: 16px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        border: 1px solid var(--border);
        margin-bottom: 24px;
    }
    .timeline-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
        color: var(--accent);
    }
    .timeline-progress-bar {
        height: 12px;
        background: var(--border);
        border-radius: 6px;
        overflow: hidden;
    }
    .timeline-progress-fill {
        height: 100%;
        background: var(--success);
        transition: width 0.5s ease-out;
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
    }
    .timeline-dates {
        display: flex;
        justify-content: space-between;
        font-size: 13px;
        color: var(--muted);
        margin-top: 6px;
    }
    
    /* ESTILO PARA BOTÕES DE NAVEGAÇÃO/FASES */
    .phase-nav {
        display: flex;
        gap: 4px;
        flex-wrap: wrap;
        margin-bottom: 16px;
        padding: 8px 0;
        border-bottom: 1px solid var(--border);
    }
    .phase-nav button {
        background: transparent;
        color: var(--muted);
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        font-weight: 500;
        transition: color 0.2s, background 0.2s;
    }
    .phase-nav button.active {
        color: var(--accent);
        background: #e5e7eb;
        font-weight: 600;
    }
    .phase-nav button:hover:not(.active) {
        color: var(--blue-main);
    }

    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
    }
    .filters-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    /* ESTILO DO BOTÃO MODERNO OMITIDO POR BREVIDADE */
    button {
      background: var(--accent);
      color: #fff;
      border: 0;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
      white-space: nowrap;
    }
    button:hover { background: #111827; box-shadow: var(--shadow-soft); }
    button:active { transform: scale(0.98); }
    #btnDeleteAll { background: var(--danger); margin-left: 20px; }
    #btnDeleteAll:hover { background: #c0392b; }
    #btnEditProcess { background: #9ca3af; }
    #btnEditProcess:hover { background: #6b7280; }
    #btnRequestNotification { background: #0ea5e9; }
    #btnRequestNotification:hover { background: #0284c7; }
    
    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 24px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border);
    }

    /* NOVO ESTILO PARA STATUS BAR */
    #phaseStatusBar {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border);
        flex-wrap: wrap;
    }
    .status-item {
        flex: 1;
        min-width: 150px;
        padding: 10px 15px;
        border-radius: 8px;
        text-align: left;
        font-size: 14px;
        font-weight: 600;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .status-item .count {
        display: block;
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 4px;
    }
    /* Cores dos Status Bar Items */
    .status-pendente-bar { background: #fff7ed; border-left: 5px solid var(--warning); color: var(--warning); }
    .status-em-andamento-bar { background: var(--blue-bg); border-left: 5px solid var(--blue-main); color: var(--blue-main); }
    .status-concluido-bar { background: #ecfdf5; border-left: 5px solid var(--success); color: var(--success); }
    .status-total-bar { background: #f4f6f9; border-left: 5px solid var(--accent); color: var(--accent); }


    /* ESTILO DA TABELA OMITIDO POR BREVIDADE */
    table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 20px; }
    th, td { padding: 14px 12px; border-bottom: 1px solid var(--border); vertical-align: middle; }
    th { font-size: 14px; color: var(--muted); font-weight: 600; text-transform: uppercase; background: #f4f6f9; text-align: left; }
    #table th:nth-child(1), #table td:nth-child(1) { text-align: center; width: 50px; }
    #table th:nth-child(3), #table td:nth-child(3) { text-align: center; }
    #table th:nth-child(5), #table td:nth-child(5) { text-align: center; }
    #table th:nth-child(6), #table td:nth-child(6) { text-align: center; }
    #table th:nth-child(8), #table td:nth-child(8) { text-align: center; }
    #table th:nth-child(9), #table td:nth-child(9) { text-align: center; }
    table thead tr:first-child th:first-child { border-top-left-radius: 8px; }
    table thead tr:first-child th:last-child { border-top-right-radius: 8px; }
    table tbody tr:last-child td { border-bottom: none; }
    tbody tr { cursor: grab; }
    tbody tr:hover { background-color: #f7f9fc; }
    .dragging { opacity: 0.5; background-color: #e0e7ff; }

    .chip { padding: 6px 10px; border-radius: 6px; font-size: 13px; font-weight: 600; display: inline-flex; align-items: center; }
    .status-pendente{background:#fff7ed;color:var(--warning);border:1px solid rgba(245,158,11,0.2)}
    .status-em-andamento{background:var(--blue-bg);color:var(--blue-main);border:1px solid var(--blue-border)}
    .status-concluido{background:#ecfdf5;color:var(--success);border:1px solid rgba(16,185,129,0.2)}

    /* ESTILO DOS INPUTS E MODAL OMITIDO POR BREVIDADE */
    input[type="text"], input[type="date"], select, textarea { padding: 9px 12px; border-radius: 8px; border: 1px solid var(--border); transition: border-color 0.2s, box-shadow 0.2s; min-width: 150px; }
    input[type="text"]:focus, input[type="date"]:focus, select:focus, textarea:focus { border-color: #4f46e5; outline: none; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
    .right { display: flex; gap: 8px; }
    .small{font-size: 13px; color: var(--muted);}
    .badge-overdue{color:#fff;background:var(--danger);padding:6px 8px;border-radius:8px;font-size: 13px;}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.5);}
    .modal.open{display:flex}
    .modal .dialog{ background: var(--card); padding: 24px; border-radius: 12px; min-width: 360px; max-width: 720px; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); transform: translateY(0); transition: transform 0.3s ease-out; }
    .form-row{display:flex;gap:12px;margin-bottom:12px}
    .form-row > *{flex:1}
    textarea{width:100%;height:80px;padding:10px;border-radius:8px;border:1px solid var(--border);}
    .actions{display:flex;justify-content:flex-end;gap:8px;margin-top:16px}
    /* RESPONSIVIDADE OMITIDA POR BREVIDADE */
    @media(max-width:1024px) {
        .controls { flex-direction: column; align-items: stretch; }
        .filters-group { flex-direction: column; align-items: stretch;}
        .right { flex-direction: row; justify-content: space-between; }
        #btnDeleteAll { margin-left: 0; }
        .proc-info { flex-direction: column; align-items: flex-start; }
        .wrap { margin: 20px auto; padding: 0 10px; }
    }
    @media(max-width:820px){
      #phaseStatusBar { gap: 10px; }
      .status-item { min-width: 45%; }
      table thead{display:none}
      table,tr,td{display:block;width:100%}
      td{border-bottom: 1px solid var(--border); padding: 10px 8px; background: transparent; text-align: left !important;} 
      td:before{content:attr(data-label);font-weight: 600;display:block;margin-bottom:4px;color:var(--accent)}
      .form-row{flex-direction: column; gap: 8px;}
      .filters, .right { flex-direction: column; align-items: stretch;}
    }
  </style>
</head>
<body onload="checkDeadlinesAndNotify()">
  <div class="wrap">
    <header>
      <div class="header-top">
        <h1>GEPLIC — Gerenciador de Projetos de Licitação</h1>
        <button id="btnRequestNotification" style="padding: 10px 12px; font-size: 14px;">Ativar Alertas</button>
      </div>

      <div id="procInfo" class="proc-info">
        <div class="proc-details">
          <div id="displayProcNumber">Processo nº: <span>-</span></div>
          <div id="displayProcObject">Objeto: <span>-</span></div>
        </div>
        <button id="btnEditProcess" style="padding: 10px 12px; font-size: 14px; background-color: #8b919b; color: #fff; border: none; transition: color 0.3s ease;">Editar Processo/Objeto</button>
      </div>
      
      <div id="projectTimeline" class="project-timeline">
          <div class="timeline-header">
              <span>Cronograma do Projeto</span>
              <span id="timelineDuration">Duração: -</span>
          </div>
          <div class="timeline-progress-bar">
              <div id="timelineFill" class="timeline-progress-fill" style="width: 0%;"></div>
          </div>
          <div class="timeline-dates">
              <span id="timelineStart">Início: -</span>
              <span id="timelineEnd">Fim: -</span>
          </div>
      </div>

      <div class="phase-nav">
        <button data-phase="Todos" class="active" onclick="switchPhase('Todos')">Visão Geral</button>
        <button data-phase="Interna" onclick="switchPhase('Interna')">Fase Interna</button>
        <button data-phase="Publicação" onclick="switchPhase('Publicação')">Fase de Publicação</button>
        <button data-phase="Externa" onclick="switchPhase('Externa')">Fase Externa</button>
      </div>

      <div class="controls">
        <div class="filters-group">
          <input id="search" type="text" placeholder="Pesquisar...">
          <select id="filterStatus"><option value="">Todos status</option><option value="Pendente">Pendente</option><option value="Em andamento">Em andamento</option><option value="Concluído">Concluído</option></select>
        </div>
        <div class="right">
          <button id="btnAdd" style="background-color: #3b82f6; color: #fff; border: none;">+ Nova Etapa</button>
          <button id="btnExport">Exportar (.xlsx)</button>
          <button id="btnImport">Importar (.xlsx)</button>
          <button id="btnDeleteAll">Apagar Tudo</button>
        </div>
      </div>
    </header>

    <section class="card">
      <div id="phaseStatusBar">
        </div>
      
      <div style="display:flex;justify-content:space-between;align-items:center; padding-bottom: 10px;">
        <div class="small">Arraste linhas para reordenar etapas (botão direito do mouse direito).</div>
        <div class="small">Hoje: <span id="today"></span></div>
      </div>

      <table id="table">
        <thead>
          <tr>
            <th>#</th>
            <th>Nº Licitação</th>
            <th>Etapa</th>
            <th>Responsável</th>
            <th>Prazo</th>
            <th>Status</th>
            <th>Observação</th>
            <th>Dias</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="empty" class="small" style="margin-top:12px; text-align: center; padding: 20px;">Nenhuma etapa cadastrada — clique em "+ Nova etapa" para começar.</div>
    </section>
  </div>

  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="dialog">
      <h3 id="modalTitle">Adicionar etapa</h3>
      <div class="form-row">
        <input id="procNumber" placeholder="Número Licitação / Pregão">
        <input id="stage" placeholder="Etapa (ex: Publicação, Propostas)">
      </div>
      <div class="form-row">
        <input id="responsible" placeholder="Responsável (nome e setor)">
        <input id="emailResponsible" type="email" placeholder="E-mail do Responsável (para alerta)">
      </div>
      <div class="form-row">
        <select id="phaseSelect">
            <option value="Interna">Fase Interna</option>
            <option value="Publicação">Fase de Publicação</option>
            <option value="Externa">Fase Externa</option>
        </select>
        <select id="statusSelect"><option value="Pendente">Pendente</option><option value="Em andamento">Em andamento</option><option value="Concluído">Concluído</option></select>
      </div>
      <div class="form-row">
        <input id="deadline" type="date">
      </div>
      <textarea id="note" placeholder="Observações / link / caminho do documento"></textarea>
      <div class="actions">
        <button id="btnCancel" style="background: var(--muted);">Cancelar</button>
        <button id="btnSave">Salvar</button>
      </div>
    </div>
  </div>

  <div id="modalProcess" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalProcessTitle">
    <div class="dialog">
      <h3 id="modalProcessTitle">Configurar Processo Principal e Cronograma</h3>
      <div class="form-row">
        <input id="configProcNumber" placeholder="Nº do Processo Principal">
      </div>
      <div class="form-row">
        <textarea id="configProcObject" placeholder="Descrição do Objeto da Licitação"></textarea>
      </div>
      
      <div class="form-row" style="margin-top: 15px;">
        <label style="flex: 1; font-weight: 600;">Início do Projeto:</label>
        <label style="flex: 1; font-weight: 600;">Fim Previsto:</label>
      </div>
      <div class="form-row">
        <input id="configStartDate" type="date">
        <input id="configEndDate" type="date">
      </div>

      <div class="actions">
        <button id="btnCancelProcess" style="background: var(--muted);">Cancelar</button>
        <button id="btnSaveProcess">Salvar Configuração</button>
      </div>
    </div>
  </div>

  <input id="fileInput" type="file" accept=".xlsx, .xls" style="display:none">

  <script>
    const LS_KEY = 'licitacao_etapas_v2';
    const LS_PROC_KEY = 'licitacao_processo_v1';
    const LS_NOTIF_KEY = 'licitacao_notif_sent_v1';
    const DAYS_BEFORE_ALERT = 3;

    let currentPhase = 'Todos'; 

    // --- ELEMENTOS DO CRONOGRAMA E STATUS BAR ---
    const timelineDurationEl = document.getElementById('timelineDuration');
    const timelineFillEl = document.getElementById('timelineFill');
    const timelineStartEl = document.getElementById('timelineStart');
    const timelineEndEl = document.getElementById('timelineEnd');
    const phaseStatusBarEl = document.getElementById('phaseStatusBar');
    
    // Elementos do Modal de Processo (Atualizados)
    const configStartDateInput = document.getElementById('configStartDate');
    const configEndDateInput = document.getElementById('configEndDate');
    
    // Demais Elementos (Omitidos por brevidade, mas mantidos no código)
    const phaseButtons = document.querySelectorAll('.phase-nav button');
    const displayProcNumberEl = document.getElementById('displayProcNumber').querySelector('span');
    const displayProcObjectEl = document.getElementById('displayProcObject').querySelector('span');
    const modalProcess = document.getElementById('modalProcess');
    const btnEditProcess = document.getElementById('btnEditProcess');
    const configProcNumberInput = document.getElementById('configProcNumber');
    const configProcObjectTextarea = document.getElementById('configProcObject');
    const btnSaveProcess = document.getElementById('btnSaveProcess');
    const btnCancelProcess = document.getElementById('btnCancelProcess');
    const todayEl = document.getElementById('today');
    const tbody = document.querySelector('tbody');
    const empty = document.getElementById('empty');
    const search = document.getElementById('search');
    const filterStatus = document.getElementById('filterStatus');
    const btnAdd = document.getElementById('btnAdd');
    const btnExport = document.getElementById('btnExport');
    const btnImport = document.getElementById('btnImport');
    const btnDeleteAll = document.getElementById('btnDeleteAll');
    const btnRequestNotification = document.getElementById('btnRequestNotification');
    const fileInput = document.getElementById('fileInput');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const inputs = {
        procNumber:document.getElementById('procNumber'),
        stage:document.getElementById('stage'),
        responsible:document.getElementById('responsible'),
        emailResponsible:document.getElementById('emailResponsible'),
        deadline:document.getElementById('deadline'),
        phaseSelect:document.getElementById('phaseSelect'),
        statusSelect:document.getElementById('statusSelect'),
        note:document.getElementById('note')
    };
    const btnSave = document.getElementById('btnSave');
    const btnCancel = document.getElementById('btnCancel');

    let editingId = null;
    let draggedItem = null;
    let data = load();
    let processInfo = loadProcessInfo();
    
    // --- INICIALIZAÇÃO ---
    btnRequestNotification.addEventListener('click', requestNotificationPermission);
    btnEditProcess.addEventListener('click', openModalProcess);
    btnCancelProcess.addEventListener('click', closeModalProcess);
    btnSaveProcess.addEventListener('click', saveProcessInfo);
    btnAdd.addEventListener('click',()=>openModal());
    btnCancel.addEventListener('click',closeModal);
    btnSave.addEventListener('click',saveFromModal);
    search.addEventListener('input',render);
    filterStatus.addEventListener('change',render);
    btnExport.addEventListener('click',exportXLSX); 
    btnImport.addEventListener('click',()=>fileInput.click());
    fileInput.addEventListener('change',handleImport);
    btnDeleteAll.addEventListener('click', deleteAllData);

    renderToday();
    renderProcessInfo();
    renderTimeline();
    render();
    // --- FIM INICIALIZAÇÃO ---


    // --- FUNÇÕES DE STATUS BAR ---

    function renderPhaseStatusBar() {
        const dataToFilter = currentPhase === 'Todos' ? data : data.filter(r => r.phase === currentPhase);
        
        const q=search.value.toLowerCase().trim();
        const statusF=filterStatus.value;
        
        const filteredData = dataToFilter.filter(r => {
            if(statusF && r.status !== statusF) return false;
            if(!q) return true;
            return [r.procNumber, r.stage, r.responsible, r.emailResponsible, (r.note||''), r.id].join(' ').toLowerCase().includes(q);
        });

        const counts = {
            'Pendente': 0,
            'Em andamento': 0,
            'Concluído': 0,
            'Total': filteredData.length
        };

        filteredData.forEach(item => {
            counts[item.status] = (counts[item.status] || 0) + 1;
        });

        const statusHtml = `
            <div class="status-item status-pendente-bar">
                <span class="count">${counts['Pendente']}</span>
                Pendente
            </div>
            <div class="status-item status-em-andamento-bar">
                <span class="count">${counts['Em andamento']}</span>
                Em Andamento
            </div>
            <div class="status-item status-concluido-bar">
                <span class="count">${counts['Concluído']}</span>
                Concluído
            </div>
            <div class="status-item status-total-bar">
                <span class="count">${counts['Total']}</span>
                Total (${currentPhase === 'Todos' ? 'Geral' : currentPhase})
            </div>
        `;
        phaseStatusBarEl.innerHTML = statusHtml;
    }


    // --- FUNÇÕES DE CRONOGRAMA ---

    function renderTimeline() {
        const start = processInfo.startDate;
        const end = processInfo.endDate;
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        if (!start || !end) {
            timelineDurationEl.textContent = 'Duração: Não definida';
            timelineStartEl.textContent = 'Início: -';
            timelineEndEl.textContent = 'Fim: -';
            timelineFillEl.style.width = '0%';
            timelineFillEl.style.backgroundColor = 'var(--success)';
            return;
        }

        const dateStart = new Date(start + 'T00:00:00');
        const dateEnd = new Date(end + 'T00:00:00');

        const totalDurationMs = dateEnd.getTime() - dateStart.getTime();
        const totalDays = Math.ceil(totalDurationMs / (1000 * 60 * 60 * 24));
        const elapsedDurationMs = today.getTime() - dateStart.getTime();
        let elapsedDays = Math.ceil(elapsedDurationMs / (1000 * 60 * 60 * 24));
        
        let percentage;
        let finalMessage;

        if (totalDays <= 0) {
             percentage = 0;
             finalMessage = 'Duração Inválida';
             timelineFillEl.style.backgroundColor = 'var(--danger)';
        } else if (today.getTime() > dateEnd.getTime()) {
             percentage = 100;
             finalMessage = `Duração: ${totalDays} dias (FINALIZADO)`;
             timelineFillEl.style.backgroundColor = 'var(--danger)';
        } else {
             percentage = Math.max(0, Math.min(100, (elapsedDays / totalDays) * 100));
             finalMessage = `Duração: ${totalDays} dias (${totalDays - elapsedDays} restantes)`;
             timelineFillEl.style.backgroundColor = 'var(--success)';
        }


        timelineDurationEl.textContent = finalMessage;
        timelineStartEl.textContent = `Início: ${dateStart.toLocaleDateString('pt-BR')}`;
        timelineEndEl.textContent = `Fim: ${dateEnd.toLocaleDateString('pt-BR')}`;
        timelineFillEl.style.width = `${percentage.toFixed(1)}%`;
    }

    // --- FUNÇÕES DE PERSISTÊNCIA E RENDERIZAÇÃO ---

    function loadProcessInfo() {
        try {
            const raw = localStorage.getItem(LS_PROC_KEY);
            if (!raw) return { number: '', object: '', startDate: '', endDate: '' };
            return JSON.parse(raw);
        } catch (e) {
            return { number: '', object: '', startDate: '', endDate: '' };
        }
    }

    function saveProcessInfo() {
        processInfo.number = configProcNumberInput.value.trim();
        processInfo.object = configProcObjectTextarea.value.trim();
        processInfo.startDate = configStartDateInput.value;
        processInfo.endDate = configEndDateInput.value;
        
        localStorage.setItem(LS_PROC_KEY, JSON.stringify(processInfo));
        renderProcessInfo();
        renderTimeline();
        closeModalProcess();
    }

    function renderProcessInfo() {
        const num = processInfo.number || '-';
        const obj = processInfo.object || 'Nenhum objeto definido.';
        displayProcNumberEl.textContent = num;
        displayProcObjectEl.textContent = obj;
    }

    function openModalProcess() {
        configProcNumberInput.value = processInfo.number;
        configProcObjectTextarea.value = processInfo.object;
        configStartDateInput.value = processInfo.startDate;
        configEndDateInput.value = processInfo.endDate;

        modalProcess.classList.add('open');
    }

    window.switchPhase = function(phase) {
        currentPhase = phase;
        phaseButtons.forEach(btn => {
            if (btn.getAttribute('data-phase') === phase) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
        search.value = '';
        filterStatus.value = '';
        render();
    }
    
    function render(){
      renderPhaseStatusBar(); 

      const q=search.value.toLowerCase().trim();
      const statusF=filterStatus.value;
      tbody.innerHTML='';
      
      const rows=data.filter(r=>{
        if (currentPhase !== 'Todos' && r.phase !== currentPhase) { return false; }
        if(statusF&&r.status!==statusF)return false;
        if(!q)return true;
        return [r.procNumber,r.stage,r.responsible,r.emailResponsible,(r.note||''), r.id].join(' ').toLowerCase().includes(q);
      });
      
      if(rows.length===0){empty.style.display='block';}else{empty.style.display='none';}
      
      rows.forEach((r)=>{
        const tr=document.createElement('tr');
        const days=calcDays(r.deadline);
        
        const isDraggable = currentPhase !== 'Todos' && !q && !statusF;
        
        if (isDraggable) {
            tr.setAttribute('draggable', 'true');
            tr.setAttribute('data-id', r.id);
            tr.addEventListener('dragstart', dragStart);
            tr.addEventListener('dragover', dragOver);
            tr.addEventListener('drop', drop);
            tr.addEventListener('dragend', dragEnd);
        } else {
            tr.setAttribute('draggable', 'false');
            tr.style.cursor = 'default';
        }
        
        tr.innerHTML=`
          <td data-label="#">${data.findIndex(item => item.id === r.id) + 1}</td>
          <td data-label="Nº Licitação">${escapeHtml(r.procNumber||'')}</td>
          <td data-label="Etapa">${escapeHtml(r.stage||'')} <br><span class="small" style="font-weight: bold;">(${r.phase})</span></td>
          <td data-label="Responsável">${escapeHtml(r.responsible||'')} <br><span class="small">${escapeHtml(r.emailResponsible||'-')}</span></td>
          <td data-label="Prazo">${r.deadline||''}</td>
          <td data-label="Status"><span class="chip ${statusClass(r.status)}">${r.status||'Pendente'}</span></td>
          <td data-label="Observação">${escapeHtml(r.note||'')}</td>
          <td data-label="Dias">${daysDisplay(days)}</td>
          <td data-label="Ações">
            <button style="background: var(--blue-main); padding: 6px 10px; font-size: 13px;" onclick="editItem('${r.id}')">Editar</button> 
            <button style="background: var(--danger); padding: 6px 10px; font-size: 13px;" onclick="deleteItem('${r.id}')">Apagar</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    // --- FUNÇÕES DE DADOS E MODAL (CORRIGIDAS/REFORÇADAS) ---

    function load(){
        try{
            const raw=localStorage.getItem(LS_KEY);
            if(!raw)return [];
            return JSON.parse(raw).map(item => ({...item, phase: item.phase || 'Interna'}));
        } catch(e){
            return [];
        }
    }
    
    function save(){
        localStorage.setItem(LS_KEY,JSON.stringify(data));
        render();
    }
    
    function openModal(item){
      editingId=null;
      modal.classList.add('open');
      modalTitle.textContent=item?'Editar etapa':'Adicionar etapa';
      if(item){
        inputs.procNumber.value=item.procNumber||'';
        inputs.stage.value=item.stage||'';
        inputs.responsible.value=item.responsible||'';
        inputs.emailResponsible.value=item.emailResponsible||'';
        inputs.deadline.value=item.deadline||'';
        inputs.phaseSelect.value=item.phase||'Interna';
        inputs.statusSelect.value=item.status||'Pendente';
        inputs.note.value=item.note||'';
        editingId=item.id;
      }
      else{
        inputs.procNumber.value='';
        inputs.stage.value='';
        inputs.responsible.value='';
        inputs.emailResponsible.value='';
        inputs.deadline.value='';
        inputs.phaseSelect.value=currentPhase === 'Todos' ? 'Interna' : currentPhase;
        inputs.statusSelect.value='Pendente';
        inputs.note.value='';
      }
    }
    
    function saveFromModal(){
      const obj={
        procNumber:inputs.procNumber.value.trim(),
        stage:inputs.stage.value.trim(),
        responsible:inputs.responsible.value.trim(),
        emailResponsible:inputs.emailResponsible.value.trim(),
        deadline:inputs.deadline.value,
        phase:inputs.phaseSelect.value,
        status:inputs.statusSelect.value,
        note:inputs.note.value.trim()
      };
      if(!obj.stage||!obj.procNumber){alert('Preencha pelo menos a Etapa e o Nº da Licitação.');return;}
      
      if(editingId){
        const idx=data.findIndex(x=>x.id===editingId);
        if(idx>=0){ data[idx]=Object.assign({id:editingId},obj); }
      }else{
        data.push(Object.assign({id:uid()},obj));
      }
      save();
      checkDeadlinesAndNotify();
      closeModal();
    }
    
    // FUNÇÃO DE EDIÇÃO REFORÇADA COM LOG (para debug)
    window.editItem=function(id){
        const item=data.find(x=>x.id===id);
        if(!item){
            console.error(`Item com ID ${id} não encontrado para edição.`);
            return;
        }
        console.log(`Editando item:`, item); // Log para confirmar que o item foi encontrado
        openModal(item);
    }


    // --- FUNÇÕES DE DRAG AND DROP, IMPORTAÇÃO E AUXILIARES (Omitidas, mas mantidas) ---

    function closeModalProcess() {modalProcess.classList.remove('open');}
    function renderToday(){const d=new Date();todayEl.textContent=d.toLocaleDateString('pt-BR');}
    function closeModal(){modal.classList.remove('open');editingId=null;}
    window.deleteItem=function(id){if(!confirm('Apagar esta etapa?'))return;data=data.filter(x=>x.id!==id);save();}
    
    function dragStart(e) { draggedItem = this; e.dataTransfer.effectAllowed = 'move'; e.dataTransfer.setData('text/plain', this.getAttribute('data-id')); setTimeout(() => this.classList.add('dragging'), 0); }
    function dragOver(e) { e.preventDefault(); if (draggedItem !== this) { const rect = this.getBoundingClientRect(); const midpoint = rect.y + rect.height / 2; this.style.borderTop = (e.clientY < midpoint) ? '2px solid var(--blue-main)' : ''; this.style.borderBottom = (e.clientY >= midpoint) ? '2px solid var(--blue-main)' : ''; } }
    function drop(e) { e.preventDefault(); this.style.borderTop = ''; this.style.borderBottom = ''; if (draggedItem === this || currentPhase === 'Todos') return; const draggedId = e.dataTransfer.getData('text/plain'); const targetId = this.getAttribute('data-id'); const phaseData = data.filter(item => item.phase === currentPhase); const otherData = data.filter(item => item.phase !== currentPhase); const draggedIndexInPhase = phaseData.findIndex(item => item.id === draggedId); const targetIndexInPhase = phaseData.findIndex(item => item.id === targetId); if (draggedIndexInPhase === -1 || targetIndexInPhase === -1) return; const item = phaseData.splice(draggedIndexInPhase, 1)[0]; const rect = this.getBoundingClientRect(); const midpoint = rect.y + rect.height / 2; let newTargetIndex = targetIndexInPhase; if (e.clientY > midpoint) { newTargetIndex++; } phaseData.splice(newTargetIndex, 0, item); data = otherData.concat(phaseData); save(); }
    function dragEnd(e) { this.classList.remove('dragging'); this.style.borderTop = ''; this.style.borderBottom = ''; draggedItem = null; }

    function uid(){return Math.random().toString(36).slice(2,9);}
    function statusClass(s){if(s==='Concluído')return'status-concluido';if(s==='Em andamento')return'status-em-andamento';return'status-pendente';}
    function calcDays(deadline){if(!deadline) return null;const d = new Date(deadline + 'T00:00:00');if(isNaN(d)) return null;const now = new Date();const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());const diffTime = d.getTime() - startOfDay.getTime();const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));return diffDays;}
    function daysDisplay(days){if(days === null) return '-';if(days < 0) return`<span class="badge-overdue">${days} dias (atrasado)</span>`;if(days === 0) return'Hoje';return`${days} dias`;}
    
    function deleteAllData() {if(data.length === 0) { alert("Não há dados para apagar."); return; }const confirmation = confirm("ATENÇÃO: Você realmente deseja apagar todos os dados do projeto? Esta ação é irreversível!");if (confirmation) {data = [];localStorage.removeItem(LS_NOTIF_KEY);save();alert("Todos os dados foram apagados com sucesso.");}}
    function exportXLSX() {if (data.length === 0) { alert('Nenhum dado encontrado para exportar.'); return; }const headers = ['id', 'Fase', 'Nº Licitação', 'Etapa', 'Responsável', 'Email Responsável', 'Prazo', 'Status', 'Observação'];const sheetData = data.map(item => ({id: item.id, Fase: item.phase || 'Interna', 'Nº Licitação': item.procNumber || '','Etapa': item.stage || '','Responsável': item.responsible || '','Email Responsável': item.emailResponsible || '', 'Prazo': item.deadline || '','Status': item.status || 'Pendente','Observação': item.note || ''}));const ws = XLSX.utils.json_to_sheet(sheetData, {header: headers});const wb = XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb, ws, "Etapas de Licitação");XLSX.writeFile(wb, "licitacoes.xlsx");}
    function handleImport(e){const f = e.target.files[0];if (!f) return;const reader = new FileReader();reader.onload = function(ev){try{const dataRead = ev.target.result;const workbook = XLSX.read(dataRead, {type: 'binary'});const firstSheetName = workbook.SheetNames[0];const worksheet = workbook.Sheets[firstSheetName];const jsonArr = XLSX.utils.sheet_to_json(worksheet);const importedData = jsonArr.map(row => {return {id: row.id && row.id.toString().trim() !== '' ? row.id.toString() : uid(), phase: row['Fase'] || 'Interna', procNumber: row['Nº Licitação'] ? row['Nº Licitação'].toString() : '',stage: row['Etapa'] ? row['Etapa'].toString() : '',responsible: row['Responsável'] ? row['Responsável'].toString() : '',emailResponsible: row['Email Responsável'] ? row['Email Responsável'].toString() : '',deadline: row['Prazo'] ? row['Prazo'].toString() : '', status: row['Status'] ? row['Status'].toString() : 'Pendente',note: row['Observação'] ? row['Observação'].toString() : ''};});const validImportedData = importedData.filter(item => item.procNumber && item.stage);if(validImportedData.length > 0) {data = data.concat(validImportedData);save();alert(`Importação concluída. ${validImportedData.length} etapas adicionadas.`);} else {alert('Nenhuma etapa válida encontrada para importar. Certifique-se de que as colunas "Nº Licitação" e "Etapa" estão preenchidas.');}}catch(err){console.error(err);alert('Erro ao importar o arquivo XLSX: ' + err.message);};} ;reader.readAsBinaryString(f);}
    function escapeHtml(s){if(!s)return'';return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');}
    function requestNotificationPermission() {if (!('Notification' in window)) {alert('Seu navegador não suporta notificações de desktop.');return;}Notification.requestPermission().then(permission => {if (permission === 'granted') {alert('Alertas de prazo ativados com sucesso!');checkDeadlinesAndNotify();} else if (permission === 'denied') {alert('Permissão de alertas negada. Você precisará reativá-la nas configurações do navegador.');} else {alert('Permissão pendente. Clique em "Ativar Alertas" novamente se mudar de ideia.');}});}
    function loadNotificationHistory() {try {const raw = localStorage.getItem(LS_NOTIF_KEY);return raw ? JSON.parse(raw) : {};} catch (e) {return {};}}
    function saveNotificationHistory(history) {localStorage.setItem(LS_NOTIF_KEY, JSON.stringify(history));}
    function checkDeadlinesAndNotify() {if (!('Notification' in window) || Notification.permission !== 'granted') {return;}const today = new Date().toISOString().slice(0, 10);const history = loadNotificationHistory();data.forEach(item => {const days = calcDays(item.deadline);const isAlertCondition = (item.status !== 'Concluído' && days !== null && (days <= DAYS_BEFORE_ALERT && days >= 0));const isOverdueAlert = (item.status !== 'Concluído' && days !== null && days < 0 && days >= -1);const notificationKey = item.id + '_' + today;const alreadyNotified = history[notificationKey];if ((isAlertCondition || isOverdueAlert) && !alreadyNotified) {let bodyMessage = '';if (days < 0) {bodyMessage = `ATRASO: A etapa ${item.stage} está ${Math.abs(days)} dias atrasada! Responsável: ${item.responsible || 'Não definido'}`;} else if (days === 0) {bodyMessage = `Prazo FINAL hoje para a etapa ${item.stage} na licitação ${item.procNumber}. Responsável: ${item.responsible || 'Não definido'}`;} else {bodyMessage = `Faltam ${days} dias para a etapa ${item.stage} na licitação ${item.procNumber}. Responsável: ${item.responsible || 'Não definido'}`;}new Notification('ALERTA DE PRAZO: ' + item.stage, {body: bodyMessage,icon: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ef4444"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>'});history[notificationKey] = true;saveNotificationHistory(history);}});const newHistory = {};for (const key in history) {if (key.includes(today)) {newHistory[key] = true;}}saveNotificationHistory(newHistory);}
  </script>
</body>
</html>

2) Ajuste o mesmo, para que os dados sejam hospedados no prório servidor e não na máquina (como acontece da forma atual). 
